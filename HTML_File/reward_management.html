<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n l√Ω ph·∫ßn th∆∞·ªüng - Vietravel Loyalty</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f8f9fa;
            overflow-x: hidden;
        }

        .container {
            padding: 20px;
            max-width: 1405px;
            margin: 0 auto;
        }

        /* Header Actions */
        .header-actions {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .page-title {
            font-size: 24px;
            font-weight: 600;
            color: #2c3e50;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .btn-primary {
            background: #3498db;
            color: white;
            border-color: #3498db;
        }

        .btn-primary:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #27ae60;
            color: white;
            border-color: #27ae60;
        }

        .btn-success:hover {
            background: #219a52;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
            border-color: #6c757d;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        /* Tabs */
        .tabs-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            overflow: hidden;
        }

        .tabs {
            display: flex;
            border-bottom: 2px solid #e9ecef;
        }

        .tab {
            padding: 15px 30px;
            background: none;
            border: none;
            font-size: 15px;
            font-weight: 600;
            color: #6c757d;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .tab:hover {
            color: #3498db;
            background: #f8f9fa;
        }

        .tab.active {
            color: #3498db;
            background: white;
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 3px;
            background: #3498db;
        }

        .tab-badge {
            background: #e9ecef;
            color: #6c757d;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 12px;
            margin-left: 8px;
            font-weight: normal;
        }

        .tab.active .tab-badge {
            background: #3498db;
            color: white;
        }

        /* Statistics Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .stat-label {
            font-size: 12px;
            color: #6c757d;
            text-transform: uppercase;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 28px;
            font-weight: bold;
            color: #2c3e50;
        }

        .stat-subtitle {
            font-size: 12px;
            color: #6c757d;
            margin-top: 5px;
        }

        /* Filter Bar */
        .filter-bar {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .filter-row {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
            min-width: 150px;
        }

        .filter-label {
            font-size: 12px;
            color: #6c757d;
            font-weight: 600;
            text-transform: uppercase;
        }

        .filter-select, .filter-input {
            padding: 8px 12px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            font-size: 13px;
            background: white;
        }

        .filter-input {
            min-width: 250px;
        }

        /* Main Table */
        .table-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .table-header {
            padding: 20px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-title {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
        }

        .table-stats {
            font-size: 14px;
            color: #6c757d;
        }

        .table-wrapper {
            overflow-x: auto;
            max-height: 500px;
            overflow-y: auto;
        }

        .rewards-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }

        .rewards-table th {
            background: #f8f9fa;
            padding: 12px 8px;
            text-align: left;
            font-weight: 600;
            color: #495057;
            border-bottom: 2px solid #dee2e6;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .rewards-table td {
            padding: 12px 8px;
            border-bottom: 1px solid #f1f3f4;
            vertical-align: middle;
        }

        .rewards-table tbody tr {
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .rewards-table tbody tr:hover {
            background: #f8f9fa;
        }

        /* Status Pills */
        .status-pill {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            display: inline-block;
        }

        .status-active { background: #d4edda; color: #155724; }
        .status-inactive { background: #f8d7da; color: #721c24; }
        .status-pending { background: #fff3cd; color: #856404; }

        /* Type Badges */
        .type-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            display: inline-block;
        }

        .type-physical { background: #d1ecf1; color: #0c5460; }
        .type-voucher { background: #d4edda; color: #155724; }
        .type-coupon { background: #fff3cd; color: #856404; }

        /* Category Badge */
        .category-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            display: inline-block;
        }

        .category-redemption { background: #e3f2fd; color: #1565c0; }
        .category-program { background: #f3e5f5; color: #6a1b9a; }

        /* Progress Bar */
        .progress-bar-container {
            width: 100px;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: #3498db;
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .progress-text {
            font-size: 11px;
            color: #6c757d;
            margin-top: 4px;
        }

        /* Action Icons */
        .action-icons {
            display: flex;
            gap: 8px;
        }

        .action-icon {
            width: 28px;
            height: 28px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid #dee2e6;
            background: white;
        }

        .action-icon:hover {
            background: #f8f9fa;
            transform: translateY(-2px);
        }

        .action-icon.view { color: #3498db; }
        .action-icon.edit { color: #f39c12; }
        .action-icon.pause { color: #e67e22; }
        .action-icon.delete { color: #e74c3c; }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            max-width: 900px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            color: #2c3e50;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #6c757d;
            padding: 5px;
        }

        .modal-body {
            padding: 20px;
        }

        /* Form Sections */
        .form-section {
            margin-bottom: 30px;
        }

        .form-section-title {
            font-size: 16px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e9ecef;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .form-label {
            font-size: 13px;
            color: #6c757d;
            font-weight: 600;
        }

        .form-input, .form-select {
            padding: 8px 12px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            font-size: 14px;
        }

        .form-input[readonly] {
            background: #f8f9fa;
            cursor: not-allowed;
        }

        /* Item Search */
        .item-search-container {
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            background: #f8f9fa;
            margin-bottom: 15px;
        }

        .search-header {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 15px;
        }

        .search-input {
            flex: 1;
            padding: 10px 15px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            font-size: 14px;
        }

        .item-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            background: white;
        }

        .item-option {
            padding: 10px 15px;
            border-bottom: 1px solid #f1f3f4;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.2s ease;
        }

        .item-option:hover {
            background: #e3f2fd;
        }

        .item-option.selected {
            background: #3498db;
            color: white;
        }

        .item-info {
            flex: 1;
        }

        .item-code {
            font-weight: 600;
            font-size: 12px;
        }

        .item-name {
            font-size: 13px;
            margin-top: 2px;
        }

        .item-stock {
            font-size: 12px;
            color: #6c757d;
            font-weight: 600;
        }

        .item-option.selected .item-stock {
            color: white;
        }

        /* Custom Scrollbar */
        .table-wrapper::-webkit-scrollbar,
        .modal-content::-webkit-scrollbar,
        .item-list::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        .table-wrapper::-webkit-scrollbar-track,
        .modal-content::-webkit-scrollbar-track,
        .item-list::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        .table-wrapper::-webkit-scrollbar-thumb,
        .modal-content::-webkit-scrollbar-thumb,
        .item-list::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }

        /* Points badge */
        .points-badge {
            background: #ffd700;
            color: #333;
            padding: 4px 8px;
            border-radius: 12px;
            font-weight: bold;
            font-size: 12px;
            display: inline-block;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header Actions -->
        <div class="header-actions">
            <h1 class="page-title">üéÅ Qu·∫£n l√Ω Ph·∫ßn th∆∞·ªüng</h1>
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="openCreateModal()">
                    ‚ûï Th√™m ph·∫ßn th∆∞·ªüng m·ªõi
                </button>
                <button class="btn btn-secondary" onclick="exportRewards()">
                    üì• Export CSV
                </button>
                <button class="btn btn-secondary" onclick="importRewards()">
                    üì§ Import CSV
                </button>
                <button class="btn btn-success" onclick="syncERP()">
                    üîÑ ƒê·ªìng b·ªô ERP
                </button>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs-container">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('all', this)">
                    T·∫•t c·∫£ qu√†
                    <span class="tab-badge" id="allCount">0</span>
                </button>
                <button class="tab" onclick="switchTab('redemption', this)">
                    Qu√† quy ƒë·ªïi
                    <span class="tab-badge" id="redemptionCount">0</span>
                </button>
                <button class="tab" onclick="switchTab('program', this)">
                    Qu√† ch∆∞∆°ng tr√¨nh
                    <span class="tab-badge" id="programCount">0</span>
                </button>
            </div>
        </div>

        <!-- Statistics Cards -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">T·ªïng ph·∫ßn th∆∞·ªüng</div>
                <div class="stat-value" id="totalRewards">0</div>
                <div class="stat-subtitle">
                    <span style="color: #3498db;" id="physicalCount">0 V·∫≠t l√Ω</span> | 
                    <span style="color: #27ae60;" id="voucherCount">0 Voucher</span> | 
                    <span style="color: #f39c12;" id="couponCount">0 Coupon</span>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-label">ƒêang ho·∫°t ƒë·ªông</div>
                <div class="stat-value" id="activeRewards">0</div>
                <div class="stat-subtitle">C√≥ th·ªÉ ƒë·ªïi ngay</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">T·ªïng ƒëi·ªÉm ƒë√£ ƒë·ªïi</div>
                <div class="stat-value">2.8M</div>
                <div class="stat-subtitle">Th√°ng n√†y: 450K ƒëi·ªÉm</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Ph·∫ßn th∆∞·ªüng ph·ªï bi·∫øn</div>
                <div class="stat-value">V500K</div>
                <div class="stat-subtitle">Voucher Tour 500K (1,234 l∆∞·ª£t)</div>
            </div>
        </div>

        <!-- Filter Bar -->
        <div class="filter-bar">
            <div class="filter-row">
                <div class="filter-group" style="flex: 1;">
                    <label class="filter-label">T√¨m ki·∫øm</label>
                    <input type="text" class="filter-input" id="searchInput" placeholder="Nh·∫≠p m√£ ho·∫∑c t√™n ph·∫ßn th∆∞·ªüng..." onkeyup="filterRewards()">
                </div>
                <div class="filter-group">
                    <label class="filter-label">Lo·∫°i qu√†</label>
                    <select class="filter-select" id="typeFilter" onchange="filterRewards()">
                        <option value="">T·∫•t c·∫£</option>
                        <option value="V·∫≠t l√Ω">Qu√† v·∫≠t l√Ω</option>
                        <option value="Voucher">Voucher</option>
                        <option value="Coupon">Coupon</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Tr·∫°ng th√°i</label>
                    <select class="filter-select" id="statusFilter" onchange="filterRewards()">
                        <option value="">T·∫•t c·∫£</option>
                        <option value="Active">ƒêang ho·∫°t ƒë·ªông</option>
                        <option value="Inactive">T·∫°m d·ª´ng</option>
                        <option value="H·∫øt h√†ng">H·∫øt h√†ng</option>
                        <option value="H·∫øt h·∫°n">H·∫øt h·∫°n</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">M·ª©c ƒëi·ªÉm</label>
                    <select class="filter-select" id="pointsFilter" onchange="filterRewards()">
                        <option value="">T·∫•t c·∫£</option>
                        <option value="0-500">0 - 500 ƒëi·ªÉm</option>
                        <option value="500-1000">500 - 1000 ƒëi·ªÉm</option>
                        <option value="1000-2000">1000 - 2000 ƒëi·ªÉm</option>
                        <option value="2000+">Tr√™n 2000 ƒëi·ªÉm</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Main Table -->
        <div class="table-container">
            <div class="table-header">
                <h3 class="table-title">Danh s√°ch ph·∫ßn th∆∞·ªüng</h3>
                <div class="table-stats" id="tableStats">Hi·ªÉn th·ªã 0 ph·∫ßn th∆∞·ªüng</div>
            </div>
            <div class="table-wrapper">
                <table class="rewards-table">
                    <thead>
                        <tr>
                            <th width="100">M√£ qu√†</th>
                            <th width="220">T√™n qu√†</th>
                            <th width="80">Lo·∫°i</th>
                            <th width="100">Ph√¢n lo·∫°i</th>
                            <th width="100">T·ªìn kho (ERP)</th>
                            <th width="120">SL cho ph√©p ƒë·ªïi</th>
                            <th width="100">% S·ª≠ d·ª•ng</th>
                            <th width="100">ƒêi·ªÉm quy ƒë·ªïi</th>
                            <th width="120">Ng√†y h·∫øt h·∫°n</th>
                            <th width="80">Tr·∫°ng th√°i</th>
                            <th width="100">H√†nh ƒë·ªông</th>
                        </tr>
                    </thead>
                    <tbody id="rewardsTableBody">
                        <!-- Data will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Create/Edit Modal -->
    <div class="modal" id="rewardModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Th√™m ph·∫ßn th∆∞·ªüng m·ªõi</h2>
                <button class="modal-close" onclick="closeModal()">√ó</button>
            </div>
            <div class="modal-body">
                <!-- Gift Type Selection -->
                <div class="form-section">
                    <h3 class="form-section-title">üéÅ Lo·∫°i ph·∫ßn th∆∞·ªüng</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <label style="padding: 15px; border: 2px solid #dee2e6; border-radius: 8px; cursor: pointer; transition: all 0.3s ease;" 
                               onmouseover="this.style.borderColor='#3498db'" onmouseout="this.style.borderColor='#dee2e6'" id="redemptionLabel">
                            <input type="radio" name="giftType" value="redemption" checked onchange="toggleGiftType('redemption')" style="margin-right: 10px;">
                            <strong style="color: #2c3e50;">Qu√† quy ƒë·ªïi</strong>
                            <div style="font-size: 12px; color: #6c757d; margin-top: 5px;">H·ªôi vi√™n d√πng ƒëi·ªÉm th∆∞·ªüng ƒë·ªÉ ƒë·ªïi qu√†</div>
                        </label>
                        <label style="padding: 15px; border: 2px solid #dee2e6; border-radius: 8px; cursor: pointer; transition: all 0.3s ease;" 
                               onmouseover="this.style.borderColor='#27ae60'" onmouseout="this.style.borderColor='#dee2e6'" id="programLabel">
                            <input type="radio" name="giftType" value="program" onchange="toggleGiftType('program')" style="margin-right: 10px;">
                            <strong style="color: #2c3e50;">Qu√† ch∆∞∆°ng tr√¨nh</strong>
                            <div style="font-size: 12px; color: #6c757d; margin-top: 5px;">Qu√† t·∫∑ng t·ª´ chi·∫øn d·ªãch khuy·∫øn m√£i</div>
                        </label>
                    </div>
                </div>

                <!-- Step 1: Select Item -->
                <div class="form-section" id="itemSelectSection">
                    <h3 class="form-section-title">üì¶ Ch·ªçn ph·∫ßn qu√† t·ª´ kho ERP</h3>
                    <div class="item-search-container">
                        <div class="search-header">
                            <input type="text" class="search-input" placeholder="T√¨m ki·∫øm theo m√£ ho·∫∑c t√™n..." onkeyup="searchItems(this.value)">
                            <select class="form-select" style="width: 150px;" onchange="filterItemType(this.value)">
                                <option value="">T·∫•t c·∫£ lo·∫°i</option>
                                <option value="physical">Qu√† v·∫≠t l√Ω</option>
                                <option value="voucher">Voucher</option>
                                <option value="coupon">Coupon</option>
                            </select>
                        </div>
                        <div class="item-list" id="itemList">
                            <!-- Items will be loaded here -->
                        </div>
                    </div>
                </div>

                <!-- Selected Item Details -->
                <div class="form-section" id="selectedItemDetails" style="display: none; background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <h3 class="form-section-title">üìã Th√¥ng tin s·∫£n ph·∫©m ƒë√£ ch·ªçn</h3>
                    <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 20px;">
                        <div id="itemImage" style="background: white; border-radius: 8px; padding: 10px; min-height: 150px; display: flex; align-items: center; justify-content: center; border: 1px solid #dee2e6;">
                            <img src="" alt="" style="max-width: 100%; max-height: 150px; display: none;">
                            <span style="color: #6c757d;">üì∑ H√¨nh ·∫£nh</span>
                        </div>
                        <div>
                            <div style="margin-bottom: 10px;">
                                <strong style="color: #2c3e50; font-size: 16px;" id="selectedItemName">--</strong>
                                <span style="margin-left: 10px; background: #e3f2fd; padding: 2px 8px; border-radius: 4px; font-size: 11px;" id="selectedItemCode">--</span>
                            </div>
                            <div style="color: #6c757d; font-size: 13px; margin-bottom: 15px;" id="selectedItemDesc">--</div>
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; font-size: 12px;">
                                <div><strong>Nh√† cung c·∫•p:</strong> <span id="selectedSupplier">--</span></div>
                                <div><strong>Danh m·ª•c:</strong> <span id="selectedCategory">--</span></div>
                                <div><strong>T·ªìn kho ERP:</strong> <span id="selectedStock" style="color: #27ae60; font-weight: bold;">--</span></div>
                                <div><strong>Gi√° v·ªën:</strong> <span id="selectedCost" style="color: #e74c3c;">--</span></div>
                                <div id="additionalInfo1"></div>
                                <div id="additionalInfo2"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Configuration -->
                <div class="form-section">
                    <h3 class="form-section-title" id="configSectionTitle">‚öôÔ∏è C·∫•u h√¨nh ƒëi·ªÉm v√† s·ªë l∆∞·ª£ng</h3>
                    
                    <!-- Basic Info (From ERP) -->
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">M√£ ph·∫ßn qu√†</label>
                            <input type="text" class="form-input" id="rewardCode" readonly>
                        </div>
                        <div class="form-group">
                            <label class="form-label">T√™n ph·∫ßn qu√†</label>
                            <input type="text" class="form-input" id="rewardName" readonly>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Lo·∫°i qu√†</label>
                            <input type="text" class="form-input" id="rewardType" readonly>
                        </div>
                        <div class="form-group">
                            <label class="form-label">S·ªë l∆∞·ª£ng t·ªìn kho (ERP)</label>
                            <input type="number" class="form-input" id="erpStock" readonly>
                        </div>
                    </div>

                    <!-- Configuration for Redemption Gift -->
                    <div class="form-row" id="redemptionConfig">
                        <div class="form-group">
                            <label class="form-label">ƒêi·ªÉm quy ƒë·ªïi *</label>
                            <input type="number" class="form-input" id="redeemPoints" placeholder="Nh·∫≠p s·ªë ƒëi·ªÉm c·∫ßn ƒë·ªÉ ƒë·ªïi">
                        </div>
                        <div class="form-group">
                            <label class="form-label">S·ªë l∆∞·ª£ng cho ph√©p ƒë·ªïi *</label>
                            <input type="number" class="form-input" id="allocatedQty" placeholder="T·ªëi ƒëa b·∫±ng t·ªìn kho" onblur="validateAllocation()">
                        </div>
                    </div>

                    <!-- Configuration for Program Gift -->
                    <div class="form-row" id="programConfig" style="display: none;">
                        <div class="form-group">
                            <label class="form-label">S·ªë l∆∞·ª£ng ph√¢n b·ªï *</label>
                            <input type="number" class="form-input" id="programQty" placeholder="T·ªëi ƒëa b·∫±ng t·ªìn kho">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ghi ch√∫ ch∆∞∆°ng tr√¨nh</label>
                            <input type="text" class="form-input" id="programNote" placeholder="VD: T·∫∑ng k√®m tour Ch√¢u √Çu">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Ng√†y h·∫øt h·∫°n</label>
                            <input type="date" class="form-input" id="expiryDate">
                        </div>
                        <div class="form-group" id="autoReplenishGroup">
                            <label class="form-label">
                                <input type="checkbox" id="autoReplenish"> T·ª± ƒë·ªông b·ªï sung khi h·∫øt h√†ng
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="form-section" style="border-top: 1px solid #e9ecef; padding-top: 20px;">
                    <div class="action-buttons" style="justify-content: flex-end;">
                        <button class="btn btn-secondary" onclick="closeModal()">H·ªßy</button>
                        <button class="btn btn-primary" onclick="saveReward()">L∆∞u c·∫•u h√¨nh</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- View Detail Modal -->
    <div class="modal" id="detailModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="detailModalTitle">Chi ti·∫øt ph·∫ßn th∆∞·ªüng</h2>
                <button class="modal-close" onclick="closeDetailModal()">√ó</button>
            </div>
            <div class="modal-body" id="detailModalBody">
                <!-- Content will be dynamically loaded -->
            </div>
        </div>
    </div>

    <script>
        // Sample rewards data - adjusted for new requirements
        const rewardsData = [
            {"M√£ qu√†":"VCH001","T√™n qu√†":"Voucher Tour 100.000ƒë","Lo·∫°i":"Voucher","Ph√¢n lo·∫°i":"Qu√† quy ƒë·ªïi","T·ªìn kho (ERP)":500,"S·ªë l∆∞·ª£ng cho ph√©p ƒë·ªïi":300,"ƒêi·ªÉm quy ƒë·ªïi":100,"Ng√†y h·∫øt h·∫°n":"31/12/2025","Tr·∫°ng th√°i":"Active"},
            {"M√£ qu√†":"VCH002","T√™n qu√†":"Voucher Tour 200.000ƒë","Lo·∫°i":"Voucher","Ph√¢n lo·∫°i":"Qu√† quy ƒë·ªïi","T·ªìn kho (ERP)":400,"S·ªë l∆∞·ª£ng cho ph√©p ƒë·ªïi":250,"ƒêi·ªÉm quy ƒë·ªïi":200,"Ng√†y h·∫øt h·∫°n":"31/12/2025","Tr·∫°ng th√°i":"Active"},
            {"M√£ qu√†":"VCH003","T√™n qu√†":"Voucher Tour 500.000ƒë","Lo·∫°i":"Voucher","Ph√¢n lo·∫°i":"Qu√† quy ƒë·ªïi","T·ªìn kho (ERP)":300,"S·ªë l∆∞·ª£ng cho ph√©p ƒë·ªïi":200,"ƒêi·ªÉm quy ƒë·ªïi":500,"Ng√†y h·∫øt h·∫°n":"31/12/2025","Tr·∫°ng th√°i":"Active"},
            {"M√£ qu√†":"VCH004","T√™n qu√†":"Voucher Tour 1.000.000ƒë","Lo·∫°i":"Voucher","Ph√¢n lo·∫°i":"Qu√† ch∆∞∆°ng tr√¨nh","T·ªìn kho (ERP)":200,"S·ªë l∆∞·ª£ng cho ph√©p ƒë·ªïi":100,"ƒêi·ªÉm quy ƒë·ªïi":0,"Ng√†y h·∫øt h·∫°n":"31/12/2025","Tr·∫°ng th√°i":"Active"},
            {"M√£ qu√†":"GIFT001","T√™n qu√†":"B√¨nh gi·ªØ nhi·ªát Vietravel","Lo·∫°i":"V·∫≠t l√Ω","Ph√¢n lo·∫°i":"Qu√† quy ƒë·ªïi","T·ªìn kho (ERP)":120,"S·ªë l∆∞·ª£ng cho ph√©p ƒë·ªïi":100,"ƒêi·ªÉm quy ƒë·ªïi":500,"Ng√†y h·∫øt h·∫°n":"30/06/2025","Tr·∫°ng th√°i":"Active"},
            {"M√£ qu√†":"GIFT002","T√™n qu√†":"Balo du l·ªãch cao c·∫•p","Lo·∫°i":"V·∫≠t l√Ω","Ph√¢n lo·∫°i":"Qu√† quy ƒë·ªïi","T·ªìn kho (ERP)":80,"S·ªë l∆∞·ª£ng cho ph√©p ƒë·ªïi":50,"ƒêi·ªÉm quy ƒë·ªïi":1200,"Ng√†y h·∫øt h·∫°n":"30/06/2025","Tr·∫°ng th√°i":"Active"},
            {"M√£ qu√†":"GIFT003","T√™n qu√†":"Vali k√©o 24 inch","Lo·∫°i":"V·∫≠t l√Ω","Ph√¢n lo·∫°i":"Qu√† quy ƒë·ªïi","T·ªìn kho (ERP)":50,"S·ªë l∆∞·ª£ng cho ph√©p ƒë·ªïi":30,"ƒêi·ªÉm quy ƒë·ªïi":2000,"Ng√†y h·∫øt h·∫°n":"30/06/2025","Tr·∫°ng th√°i":"Active"},
            {"M√£ qu√†":"GIFT004","T√™n qu√†":"√Åo thun Vietravel","Lo·∫°i":"V·∫≠t l√Ω","Ph√¢n lo·∫°i":"Qu√† ch∆∞∆°ng tr√¨nh","T·ªìn kho (ERP)":300,"S·ªë l∆∞·ª£ng cho ph√©p ƒë·ªïi":200,"ƒêi·ªÉm quy ƒë·ªïi":0,"Ng√†y h·∫øt h·∫°n":"30/06/2025","Tr·∫°ng th√°i":"Active"},
            {"M√£ qu√†":"CPN001","T√™n qu√†":"Coupon CGV 100.000ƒë","Lo·∫°i":"Coupon","Ph√¢n lo·∫°i":"Qu√† quy ƒë·ªïi","T·ªìn kho (ERP)":1000,"S·ªë l∆∞·ª£ng cho ph√©p ƒë·ªïi":500,"ƒêi·ªÉm quy ƒë·ªïi":150,"Ng√†y h·∫øt h·∫°n":"31/03/2025","Tr·∫°ng th√°i":"Active"},
            {"M√£ qu√†":"CPN002","T√™n qu√†":"Coupon Grab 50.000ƒë","Lo·∫°i":"Coupon","Ph√¢n lo·∫°i":"Qu√† quy ƒë·ªïi","T·ªìn kho (ERP)":2000,"S·ªë l∆∞·ª£ng cho ph√©p ƒë·ªïi":1000,"ƒêi·ªÉm quy ƒë·ªïi":75,"Ng√†y h·∫øt h·∫°n":"31/03/2025","Tr·∫°ng th√°i":"Active"},
            {"M√£ qu√†":"VCH005","T√™n qu√†":"Voucher Ph√∫ Qu·ªëc 300.000ƒë","Lo·∫°i":"Voucher","Ph√¢n lo·∫°i":"Qu√† ch∆∞∆°ng tr√¨nh","T·ªìn kho (ERP)":150,"S·ªë l∆∞·ª£ng cho ph√©p ƒë·ªïi":150,"ƒêi·ªÉm quy ƒë·ªïi":0,"Ng√†y h·∫øt h·∫°n":"30/06/2025","Tr·∫°ng th√°i":"Active"},
            {"M√£ qu√†":"GIFT005","T√™n qu√†":"N√≥n Vietravel Limited","Lo·∫°i":"V·∫≠t l√Ω","Ph√¢n lo·∫°i":"Qu√† ch∆∞∆°ng tr√¨nh","T·ªìn kho (ERP)":500,"S·ªë l∆∞·ª£ng cho ph√©p ƒë·ªïi":300,"ƒêi·ªÉm quy ƒë·ªïi":0,"Ng√†y h·∫øt h·∫°n":"31/12/2025","Tr·∫°ng th√°i":"Active"},
            {"M√£ qu√†":"CPN003","T√™n qu√†":"Coupon Shopee 100.000ƒë","Lo·∫°i":"Coupon","Ph√¢n lo·∫°i":"Qu√† quy ƒë·ªïi","T·ªìn kho (ERP)":800,"S·ªë l∆∞·ª£ng cho ph√©p ƒë·ªïi":400,"ƒêi·ªÉm quy ƒë·ªïi":120,"Ng√†y h·∫øt h·∫°n":"30/06/2025","Tr·∫°ng th√°i":"Active"}
        ];

        // Sample ERP items - adjusted to remove services
        const erpItems = [
            {
                code: "VCH001", 
                name: "Voucher Tour 100.000ƒë", 
                type: "voucher", 
                stock: 500,
                description: "Voucher gi·∫£m gi√° tour du l·ªãch tr·ªã gi√° 100.000ƒë",
                supplier: "Vietravel",
                cost: 85000,
                validityDays: 365,
                minOrderValue: 1000000,
                category: "Tour n·ªôi ƒë·ªãa",
                image: "voucher-100k.jpg"
            },
            {
                code: "VCH002", 
                name: "Voucher Tour 200.000ƒë", 
                type: "voucher", 
                stock: 400,
                description: "Voucher gi·∫£m gi√° tour du l·ªãch tr·ªã gi√° 200.000ƒë",
                supplier: "Vietravel",
                cost: 170000,
                validityDays: 365,
                minOrderValue: 2000000,
                category: "Tour n·ªôi ƒë·ªãa",
                image: "voucher-200k.jpg"
            },
            {
                code: "VCH003", 
                name: "Voucher Tour 500.000ƒë", 
                type: "voucher", 
                stock: 300,
                description: "Voucher gi·∫£m gi√° tour du l·ªãch tr·ªã gi√° 500.000ƒë",
                supplier: "Vietravel",
                cost: 425000,
                validityDays: 365,
                minOrderValue: 5000000,
                category: "Tour qu·ªëc t·∫ø",
                image: "voucher-500k.jpg"
            },
            {
                code: "GIFT001", 
                name: "B√¨nh gi·ªØ nhi·ªát Vietravel", 
                type: "physical", 
                stock: 120,
                description: "B√¨nh gi·ªØ nhi·ªát cao c·∫•p 500ml v·ªõi logo Vietravel",
                supplier: "Lock&Lock",
                cost: 250000,
                weight: "350g",
                dimensions: "7x7x25cm",
                warranty: "12 th√°ng",
                category: "ƒê·ªì d√πng du l·ªãch",
                image: "binh-giu-nhiet.jpg"
            },
            {
                code: "GIFT002", 
                name: "Balo du l·ªãch cao c·∫•p", 
                type: "physical", 
                stock: 80,
                description: "Balo du l·ªãch 40L ch·ªëng th·∫•m n∆∞·ªõc, nhi·ªÅu ngƒÉn ti·ªán d·ª•ng",
                supplier: "Samsonite",
                cost: 850000,
                weight: "1.2kg",
                dimensions: "50x30x20cm",
                warranty: "24 th√°ng",
                category: "ƒê·ªì d√πng du l·ªãch",
                image: "balo-du-lich.jpg"
            },
            {
                code: "GIFT003",
                name: "Vali k√©o 24 inch",
                type: "physical",
                stock: 50,
                description: "Vali k√©o size trung 24 inch, 4 b√°nh xoay 360 ƒë·ªô",
                supplier: "American Tourister",
                cost: 1500000,
                weight: "3.5kg",
                dimensions: "60x40x25cm",
                warranty: "36 th√°ng",
                category: "ƒê·ªì d√πng du l·ªãch",
                image: "vali-24inch.jpg"
            },
            {
                code: "CPN001", 
                name: "Coupon CGV 100K", 
                type: "coupon", 
                stock: 5000,
                description: "Coupon xem phim t·∫°i CGV tr·ªã gi√° 100.000ƒë",
                supplier: "CGV Vietnam",
                cost: 85000,
                validityDays: 90,
                applicableDays: "T·∫•t c·∫£ c√°c ng√†y",
                format: "QR Code",
                category: "Gi·∫£i tr√≠",
                image: "cgv-voucher.jpg"
            },
            {
                code: "CPN002", 
                name: "Coupon Grab 50K", 
                type: "coupon", 
                stock: 3000,
                description: "Coupon Grab di chuy·ªÉn tr·ªã gi√° 50.000ƒë",
                supplier: "Grab Vietnam",
                cost: 42000,
                validityDays: 30,
                applicableServices: "GrabCar, GrabBike",
                maxUsage: 1,
                category: "V·∫≠n chuy·ªÉn",
                image: "grab-voucher.jpg"
            },
            {
                code: "GIFT004",
                name: "√Åo thun Vietravel Limited",
                type: "physical",
                stock: 200,
                description: "√Åo thun cotton 100% phi√™n b·∫£n gi·ªõi h·∫°n v·ªõi thi·∫øt k·∫ø ƒë·ªôc quy·ªÅn",
                supplier: "Vietravel Merchandise",
                cost: 150000,
                sizes: "S, M, L, XL",
                material: "Cotton 100%",
                colors: "Tr·∫Øng, Xanh navy",
                category: "Th·ªùi trang",
                image: "tshirt-limited.jpg"
            },
            {
                code: "GIFT005",
                name: "N√≥n Vietravel Limited",
                type: "physical",
                stock: 500,
                description: "N√≥n l∆∞·ª°i trai cao c·∫•p v·ªõi logo Vietravel th√™u",
                supplier: "Vietravel Merchandise",
                cost: 80000,
                material: "Cotton blend",
                colors: "ƒêen, Tr·∫Øng, Xanh navy",
                category: "Th·ªùi trang",
                image: "cap-vietravel.jpg"
            },
            {
                code: "CPN003",
                name: "Coupon Shopee 100K",
                type: "coupon",
                stock: 800,
                description: "Coupon mua s·∫Øm Shopee tr·ªã gi√° 100.000ƒë",
                supplier: "Shopee Vietnam",
                cost: 85000,
                validityDays: 60,
                minPurchase: 300000,
                category: "Mua s·∫Øm",
                image: "shopee-coupon.jpg"
            },
            {
                code: "VCH005",
                name: "Voucher Ph√∫ Qu·ªëc 300.000ƒë",
                type: "voucher",
                stock: 150,
                description: "Voucher gi·∫£m gi√° tour Ph√∫ Qu·ªëc tr·ªã gi√° 300.000ƒë",
                supplier: "Vietravel",
                cost: 255000,
                validityDays: 180,
                minOrderValue: 3000000,
                category: "Tour bi·ªÉn ƒë·∫£o",
                image: "voucher-pq.jpg"
            }
        ];

        let filteredRewards = [...rewardsData];
        let selectedItem = null;
        let editingReward = null;
        let currentGiftType = 'redemption';
        let currentTab = 'all';

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadRewards();
            updateStats();
            updateTabCounts();
        });

        // Switch tab
        function switchTab(tab, element) {
            currentTab = tab;
            
            // Update active tab
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            element.classList.add('active');
            
            // Filter rewards based on tab
            filterRewards();
        }

        // Update tab counts
        function updateTabCounts() {
            const all = rewardsData.length;
            const redemption = rewardsData.filter(r => r['Ph√¢n lo·∫°i'] === 'Qu√† quy ƒë·ªïi').length;
            const program = rewardsData.filter(r => r['Ph√¢n lo·∫°i'] === 'Qu√† ch∆∞∆°ng tr√¨nh').length;
            
            document.getElementById('allCount').textContent = all;
            document.getElementById('redemptionCount').textContent = redemption;
            document.getElementById('programCount').textContent = program;
        }

        // Toggle between gift types
        function toggleGiftType(type) {
            currentGiftType = type;
            
            const redemptionConfig = document.getElementById('redemptionConfig');
            const programConfig = document.getElementById('programConfig');
            const redemptionLabel = document.getElementById('redemptionLabel');
            const programLabel = document.getElementById('programLabel');
            const configTitle = document.getElementById('configSectionTitle');
            
            if (type === 'redemption') {
                redemptionConfig.style.display = 'grid';
                programConfig.style.display = 'none';
                
                redemptionLabel.style.backgroundColor = '#e3f2fd';
                redemptionLabel.style.borderColor = '#3498db';
                programLabel.style.backgroundColor = 'white';
                programLabel.style.borderColor = '#dee2e6';
                
                configTitle.textContent = '‚öôÔ∏è C·∫•u h√¨nh ƒëi·ªÉm v√† s·ªë l∆∞·ª£ng';
            } else {
                redemptionConfig.style.display = 'none';
                programConfig.style.display = 'grid';
                
                programLabel.style.backgroundColor = '#d4edda';
                programLabel.style.borderColor = '#27ae60';
                redemptionLabel.style.backgroundColor = 'white';
                redemptionLabel.style.borderColor = '#dee2e6';
                
                configTitle.textContent = '‚öôÔ∏è C·∫•u h√¨nh s·ªë l∆∞·ª£ng';
                
                const erpStock = document.getElementById('erpStock').value;
                document.getElementById('programQty').max = erpStock;
            }
        }

        // Load rewards to table
        function loadRewards() {
            const tbody = document.getElementById('rewardsTableBody');
            tbody.innerHTML = '';

            filteredRewards.forEach(reward => {
                const row = document.createElement('tr');
                const usagePercent = Math.round((reward['S·ªë l∆∞·ª£ng cho ph√©p ƒë·ªïi'] - Math.random() * reward['S·ªë l∆∞·ª£ng cho ph√©p ƒë·ªïi']) / reward['S·ªë l∆∞·ª£ng cho ph√©p ƒë·ªïi'] * 100);
                
                row.innerHTML = `
                    <td><strong>${reward['M√£ qu√†']}</strong></td>
                    <td>${reward['T√™n qu√†']}</td>
                    <td>${getTypeBadge(reward['Lo·∫°i'])}</td>
                    <td>${getCategoryBadge(reward['Ph√¢n lo·∫°i'])}</td>
                    <td>${reward['T·ªìn kho (ERP)'].toLocaleString()}</td>
                    <td>${reward['S·ªë l∆∞·ª£ng cho ph√©p ƒë·ªïi'].toLocaleString()}</td>
                    <td>
                        <div class="progress-bar-container">
                            <div class="progress-bar" style="width: ${usagePercent}%"></div>
                        </div>
                        <div class="progress-text">${usagePercent}% ƒë√£ d√πng</div>
                    </td>
                    <td>${reward['ƒêi·ªÉm quy ƒë·ªïi'] > 0 ? `<span class="points-badge">${reward['ƒêi·ªÉm quy ƒë·ªïi'].toLocaleString()} ƒëi·ªÉm</span>` : '-'}</td>
                    <td>${reward['Ng√†y h·∫øt h·∫°n']}</td>
                    <td>${getStatusPill(reward['Tr·∫°ng th√°i'])}</td>
                    <td>${getActionButtons(reward)}</td>
                `;
                tbody.appendChild(row);
            });

            document.getElementById('tableStats').textContent = `Hi·ªÉn th·ªã ${filteredRewards.length} ph·∫ßn th∆∞·ªüng`;
        }

        // Get type badge HTML
        function getTypeBadge(type) {
            const typeClasses = {
                'V·∫≠t l√Ω': 'type-physical',
                'Voucher': 'type-voucher',
                'Coupon': 'type-coupon'
            };
            return `<span class="type-badge ${typeClasses[type] || ''}">${type}</span>`;
        }

        // Get category badge HTML
        function getCategoryBadge(category) {
            const categoryClasses = {
                'Qu√† quy ƒë·ªïi': 'category-redemption',
                'Qu√† ch∆∞∆°ng tr√¨nh': 'category-program'
            };
            return `<span class="category-badge ${categoryClasses[category] || ''}">${category}</span>`;
        }

        // Get status pill HTML
        function getStatusPill(status) {
            const statusClasses = {
                'Active': 'status-active',
                'Inactive': 'status-inactive',
                'H·∫øt h√†ng': 'status-pending'
            };
            return `<span class="status-pill ${statusClasses[status] || ''}">${status}</span>`;
        }

        // Get action buttons HTML
        function getActionButtons(reward) {
            const status = reward['Tr·∫°ng th√°i'];
            let buttons = `
                <div class="action-icons">
                    <div class="action-icon view" onclick="viewReward('${reward['M√£ qu√†']}')" title="Xem">üëÅÔ∏è</div>
                    <div class="action-icon edit" onclick="editReward('${reward['M√£ qu√†']}')" title="S·ª≠a">‚úèÔ∏è</div>
            `;
            
            if (status === 'Active') {
                buttons += `<div class="action-icon pause" onclick="pauseReward('${reward['M√£ qu√†']}')" title="T·∫°m d·ª´ng">‚è∏Ô∏è</div>`;
            } else {
                buttons += `<div class="action-icon delete" onclick="deleteReward('${reward['M√£ qu√†']}')" title="X√≥a">üóëÔ∏è</div>`;
            }
            
            buttons += '</div>';
            return buttons;
        }

        // Filter rewards
        function filterRewards() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const typeFilter = document.getElementById('typeFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;
            const pointsFilter = document.getElementById('pointsFilter').value;
            
            filteredRewards = rewardsData.filter(reward => {
                // Tab filter
                if (currentTab === 'redemption' && reward['Ph√¢n lo·∫°i'] !== 'Qu√† quy ƒë·ªïi') {
                    return false;
                }
                if (currentTab === 'program' && reward['Ph√¢n lo·∫°i'] !== 'Qu√† ch∆∞∆°ng tr√¨nh') {
                    return false;
                }
                
                // Search filter
                if (searchTerm && 
                    !reward['M√£ qu√†'].toLowerCase().includes(searchTerm) && 
                    !reward['T√™n qu√†'].toLowerCase().includes(searchTerm)) {
                    return false;
                }
                
                // Type filter
                if (typeFilter && reward['Lo·∫°i'] !== typeFilter) {
                    return false;
                }
                
                // Status filter
                if (statusFilter && reward['Tr·∫°ng th√°i'] !== statusFilter) {
                    return false;
                }
                
                // Points filter
                if (pointsFilter && reward['Ph√¢n lo·∫°i'] === 'Qu√† quy ƒë·ªïi') {
                    const points = reward['ƒêi·ªÉm quy ƒë·ªïi'];
                    if (pointsFilter === '0-500' && (points < 0 || points > 500)) return false;
                    if (pointsFilter === '500-1000' && (points < 500 || points > 1000)) return false;
                    if (pointsFilter === '1000-2000' && (points < 1000 || points > 2000)) return false;
                    if (pointsFilter === '2000+' && points < 2000) return false;
                }
                
                return true;
            });
            
            loadRewards();
        }

        // Update statistics
        function updateStats() {
            const physicalCount = rewardsData.filter(r => r['Lo·∫°i'] === 'V·∫≠t l√Ω').length;
            const voucherCount = rewardsData.filter(r => r['Lo·∫°i'] === 'Voucher').length;
            const couponCount = rewardsData.filter(r => r['Lo·∫°i'] === 'Coupon').length;
            
            document.getElementById('totalRewards').textContent = rewardsData.length;
            document.getElementById('activeRewards').textContent = rewardsData.filter(r => r['Tr·∫°ng th√°i'] === 'Active').length;
            document.getElementById('physicalCount').textContent = physicalCount + ' V·∫≠t l√Ω';
            document.getElementById('voucherCount').textContent = voucherCount + ' Voucher';
            document.getElementById('couponCount').textContent = couponCount + ' Coupon';
        }

        // Open create modal
        function openCreateModal() {
            editingReward = null;
            selectedItem = null;
            document.getElementById('modalTitle').textContent = 'Th√™m ph·∫ßn th∆∞·ªüng m·ªõi';
            loadERPItems();
            clearForm();
            document.getElementById('rewardModal').classList.add('active');
        }

        // Load ERP items to select list
        function loadERPItems() {
            const itemList = document.getElementById('itemList');
            itemList.innerHTML = '';
            
            erpItems.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'item-option';
                itemDiv.onclick = () => selectItem(item);
                itemDiv.innerHTML = `
                    <div class="item-info">
                        <div class="item-code">${item.code}</div>
                        <div class="item-name">${item.name}</div>
                    </div>
                    <div class="item-stock">T·ªìn: ${item.stock.toLocaleString()}</div>
                `;
                itemList.appendChild(itemDiv);
            });
        }

        // Select an item from ERP
        function selectItem(item) {
            selectedItem = item;
            
            // Update UI
            document.querySelectorAll('.item-option').forEach(el => el.classList.remove('selected'));
            event.currentTarget.classList.add('selected');
            
            // Show selected item details section
            document.getElementById('selectedItemDetails').style.display = 'block';
            
            // Populate selected item details
            document.getElementById('selectedItemName').textContent = item.name;
            document.getElementById('selectedItemCode').textContent = item.code;
            document.getElementById('selectedItemDesc').textContent = item.description;
            document.getElementById('selectedSupplier').textContent = item.supplier;
            document.getElementById('selectedCategory').textContent = item.category;
            document.getElementById('selectedStock').textContent = item.stock.toLocaleString();
            document.getElementById('selectedCost').textContent = item.cost.toLocaleString() + 'ƒë';
            
            // Show type-specific information
            const info1 = document.getElementById('additionalInfo1');
            const info2 = document.getElementById('additionalInfo2');
            
            if (item.type === 'physical') {
                info1.innerHTML = `<strong>K√≠ch th∆∞·ªõc:</strong> ${item.dimensions || 'N/A'}`;
                info2.innerHTML = `<strong>B·∫£o h√†nh:</strong> ${item.warranty || 'N/A'}`;
            } else if (item.type === 'voucher' || item.type === 'coupon') {
                info1.innerHTML = `<strong>Hi·ªáu l·ª±c:</strong> ${item.validityDays} ng√†y`;
                info2.innerHTML = `<strong>Gi√° tr·ªã t·ªëi thi·ªÉu:</strong> ${item.minOrderValue ? item.minOrderValue.toLocaleString() + 'ƒë' : 'Kh√¥ng'}`;
            }
            
            // Update image placeholder
            const imageDiv = document.getElementById('itemImage');
            imageDiv.innerHTML = `<div style="text-align: center;">
                <div style="font-size: 48px; color: #3498db; margin-bottom: 10px;">
                    ${item.type === 'physical' ? 'üéÅ' : item.type === 'voucher' ? 'üé´' : 'üéüÔ∏è'}
                </div>
                <div style="font-size: 11px; color: #6c757d;">${item.image}</div>
            </div>`;
            
            // Populate form with basic info
            document.getElementById('rewardCode').value = item.code;
            document.getElementById('rewardName').value = item.name;
            document.getElementById('rewardType').value = getItemTypeDisplay(item.type);
            document.getElementById('erpStock').value = item.stock;
            document.getElementById('allocatedQty').max = item.stock;
            document.getElementById('programQty').max = item.stock;
            
            // Auto-suggest redemption points based on cost
            const suggestedPoints = Math.round(item.cost / 1000) * 10;
            document.getElementById('redeemPoints').placeholder = `G·ª£i √Ω: ${suggestedPoints} ƒëi·ªÉm`;
        }

        // Get display name for item type
        function getItemTypeDisplay(type) {
            const typeMap = {
                'physical': 'V·∫≠t l√Ω',
                'voucher': 'Voucher',
                'coupon': 'Coupon'
            };
            return typeMap[type] || type;
        }

        // Search items
        function searchItems(term) {
            const filtered = erpItems.filter(item => 
                item.code.toLowerCase().includes(term.toLowerCase()) ||
                item.name.toLowerCase().includes(term.toLowerCase())
            );
            
            const itemList = document.getElementById('itemList');
            itemList.innerHTML = '';
            
            filtered.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'item-option';
                itemDiv.onclick = () => selectItem(item);
                itemDiv.innerHTML = `
                    <div class="item-info">
                        <div class="item-code">${item.code}</div>
                        <div class="item-name">${item.name}</div>
                    </div>
                    <div class="item-stock">T·ªìn: ${item.stock.toLocaleString()}</div>
                `;
                itemList.appendChild(itemDiv);
            });
        }

        // Filter item type
        function filterItemType(type) {
            const filtered = type ? erpItems.filter(item => item.type === type) : erpItems;
            
            const itemList = document.getElementById('itemList');
            itemList.innerHTML = '';
            
            filtered.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'item-option';
                itemDiv.onclick = () => selectItem(item);
                itemDiv.innerHTML = `
                    <div class="item-info">
                        <div class="item-code">${item.code}</div>
                        <div class="item-name">${item.name}</div>
                    </div>
                    <div class="item-stock">T·ªìn: ${item.stock.toLocaleString()}</div>
                `;
                itemList.appendChild(itemDiv);
            });
        }

        // Validate allocation quantity
        function validateAllocation() {
            const allocatedQty = document.getElementById('allocatedQty');
            const erpStock = document.getElementById('erpStock').value;
            
            if (parseInt(allocatedQty.value) > parseInt(erpStock)) {
                alert('S·ªë l∆∞·ª£ng cho ph√©p ƒë·ªïi kh√¥ng ƒë∆∞·ª£c v∆∞·ª£t qu√° t·ªìn kho!');
                allocatedQty.value = erpStock;
            }
        }

        // Clear form
        function clearForm() {
            document.getElementById('rewardCode').value = '';
            document.getElementById('rewardName').value = '';
            document.getElementById('rewardType').value = '';
            document.getElementById('erpStock').value = '';
            document.getElementById('redeemPoints').value = '';
            document.getElementById('allocatedQty').value = '';
            document.getElementById('programQty').value = '';
            document.getElementById('programNote').value = '';
            document.getElementById('expiryDate').value = '';
            document.getElementById('autoReplenish').checked = false;
            document.getElementById('selectedItemDetails').style.display = 'none';
            document.getElementById('itemSelectSection').style.display = 'block';
            
            // Reset gift type to redemption
            document.querySelector('input[name="giftType"][value="redemption"]').checked = true;
            toggleGiftType('redemption');
        }

        // Close modal
        function closeModal() {
            document.getElementById('rewardModal').classList.remove('active');
            clearForm();
        }

        // Save reward
        function saveReward() {
            if (!selectedItem && !editingReward) {
                alert('Vui l√≤ng ch·ªçn m·ªôt ph·∫ßn qu√† t·ª´ danh s√°ch ERP!');
                return;
            }
            
            if (currentGiftType === 'redemption') {
                const redeemPoints = document.getElementById('redeemPoints').value;
                const allocatedQty = document.getElementById('allocatedQty').value;
                
                if (!redeemPoints || !allocatedQty) {
                    alert('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin b·∫Øt bu·ªôc (ƒêi·ªÉm quy ƒë·ªïi v√† S·ªë l∆∞·ª£ng cho ph√©p ƒë·ªïi)!');
                    return;
                }
                
                alert(`Qu√† quy ƒë·ªïi "${selectedItem ? selectedItem.name : editingReward['T√™n qu√†']}" ƒë√£ ƒë∆∞·ª£c l∆∞u th√†nh c√¥ng!\n` +
                      `- ƒêi·ªÉm quy ƒë·ªïi: ${redeemPoints} ƒëi·ªÉm\n` + 
                      `- S·ªë l∆∞·ª£ng cho ph√©p ƒë·ªïi: ${allocatedQty}`);
            } else {
                const programQty = document.getElementById('programQty').value;
                const programNote = document.getElementById('programNote').value;
                
                if (!programQty) {
                    alert('Vui l√≤ng nh·∫≠p s·ªë l∆∞·ª£ng qu√† ch∆∞∆°ng tr√¨nh!');
                    return;
                }
                
                alert(`Qu√† ch∆∞∆°ng tr√¨nh "${selectedItem ? selectedItem.name : editingReward['T√™n qu√†']}" ƒë√£ ƒë∆∞·ª£c l∆∞u th√†nh c√¥ng!\n` +
                      `- S·ªë l∆∞·ª£ng: ${programQty}\n` +
                      `- Ghi ch√∫: ${programNote || 'Kh√¥ng c√≥'}`);
            }
            
            closeModal();
        }

        // View reward details
        function viewReward(code) {
            const reward = rewardsData.find(r => r['M√£ qu√†'] === code);
            if (!reward) return;
            
            document.getElementById('detailModalTitle').textContent = reward['T√™n qu√†'];
            
            const isRedemption = reward['Ph√¢n lo·∫°i'] === 'Qu√† quy ƒë·ªïi';
            
            document.getElementById('detailModalBody').innerHTML = `
                <div class="form-section">
                    <h3 class="form-section-title">üìã Th√¥ng tin c∆° b·∫£n</h3>
                    <div style="display: grid; gap: 15px;">
                        <div><strong>M√£ ph·∫ßn qu√†:</strong> ${reward['M√£ qu√†']}</div>
                        <div><strong>Lo·∫°i:</strong> ${getTypeBadge(reward['Lo·∫°i'])}</div>
                        <div><strong>Ph√¢n lo·∫°i:</strong> ${getCategoryBadge(reward['Ph√¢n lo·∫°i'])}</div>
                        <div><strong>Tr·∫°ng th√°i:</strong> ${getStatusPill(reward['Tr·∫°ng th√°i'])}</div>
                    </div>
                </div>
                
                <div class="form-section">
                    <h3 class="form-section-title">üìä Th√¥ng tin t·ªìn kho</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div>
                            <div style="font-size: 12px; color: #6c757d;">T·ªìn kho ERP</div>
                            <div style="font-size: 24px; font-weight: bold;">${reward['T·ªìn kho (ERP)'].toLocaleString()}</div>
                        </div>
                        <div>
                            <div style="font-size: 12px; color: #6c757d;">SL cho ph√©p ƒë·ªïi</div>
                            <div style="font-size: 24px; font-weight: bold;">${reward['S·ªë l∆∞·ª£ng cho ph√©p ƒë·ªïi'].toLocaleString()}</div>
                        </div>
                    </div>
                    <div style="margin-top: 15px;">
                        <div style="font-size: 12px; color: #6c757d; margin-bottom: 5px;">T·ª∑ l·ªá s·ª≠ d·ª•ng</div>
                        <div class="progress-bar-container" style="width: 100%; height: 20px;">
                            <div class="progress-bar" style="width: 65%; height: 100%;"></div>
                        </div>
                        <div style="font-size: 12px; color: #6c757d; margin-top: 5px;">325 / 500 (65%)</div>
                    </div>
                </div>
                
                <div class="form-section">
                    <h3 class="form-section-title">${isRedemption ? 'üéØ C·∫•u h√¨nh ƒë·ªïi th∆∞·ªüng' : 'üéÅ C·∫•u h√¨nh qu√† t·∫∑ng'}</h3>
                    <div style="display: grid; gap: 15px;">
                        ${isRedemption ? 
                            `<div><strong>ƒêi·ªÉm quy ƒë·ªïi:</strong> <span class="points-badge">${reward['ƒêi·ªÉm quy ƒë·ªïi'].toLocaleString()} ƒëi·ªÉm</span></div>` :
                            `<div><strong>Lo·∫°i qu√†:</strong> Qu√† t·∫∑ng ch∆∞∆°ng tr√¨nh</div>`
                        }
                        <div><strong>Ng√†y h·∫øt h·∫°n:</strong> ${reward['Ng√†y h·∫øt h·∫°n']}</div>
                        <div><strong>Gi·ªõi h·∫°n/ng∆∞·ªùi:</strong> ${isRedemption ? 'Kh√¥ng gi·ªõi h·∫°n' : '1 qu√†/ng∆∞·ªùi'}</div>
                    </div>
                </div>
                
                <div class="form-section">
                    <h3 class="form-section-title">üìà Th·ªëng k√™ s·ª≠ d·ª•ng</h3>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px;">
                        <div style="text-align: center;">
                            <div style="font-size: 24px; font-weight: bold; color: #3498db;">1,234</div>
                            <div style="font-size: 12px; color: #6c757d;">L∆∞·ª£t ${isRedemption ? 'ƒë·ªïi' : 't·∫∑ng'}</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 24px; font-weight: bold; color: #27ae60;">${isRedemption ? '617K' : '0'}</div>
                            <div style="font-size: 12px; color: #6c757d;">${isRedemption ? 'ƒêi·ªÉm ƒë√£ d√πng' : 'ƒêi·ªÉm t·∫∑ng'}</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 24px; font-weight: bold; color: #f39c12;">4.8</div>
                            <div style="font-size: 12px; color: #6c757d;">ƒê√°nh gi√° TB</div>
                        </div>
                    </div>
                </div>
                
                <div class="form-section" style="border-top: 1px solid #e9ecef; padding-top: 20px;">
                    <div class="action-buttons" style="justify-content: flex-end;">
                        <button class="btn btn-secondary" onclick="closeDetailModal()">ƒê√≥ng</button>
                        <button class="btn btn-primary" onclick="editReward('${reward['M√£ qu√†']}')">Ch·ªânh s·ª≠a</button>
                    </div>
                </div>
            `;
            
            document.getElementById('detailModal').classList.add('active');
        }

        // Close detail modal
        function closeDetailModal() {
            document.getElementById('detailModal').classList.remove('active');
        }

        // Edit reward
        function editReward(code) {
            const reward = rewardsData.find(r => r['M√£ qu√†'] === code);
            if (!reward) return;
            
            editingReward = reward;
            document.getElementById('modalTitle').textContent = 'Ch·ªânh s·ª≠a ph·∫ßn th∆∞·ªüng';
            
            // Set gift type based on category
            const isRedemption = reward['Ph√¢n lo·∫°i'] === 'Qu√† quy ƒë·ªïi';
            document.querySelector(`input[name="giftType"][value="${isRedemption ? 'redemption' : 'program'}"]`).checked = true;
            toggleGiftType(isRedemption ? 'redemption' : 'program');
            
            // Populate form with reward data
            document.getElementById('rewardCode').value = reward['M√£ qu√†'];
            document.getElementById('rewardName').value = reward['T√™n qu√†'];
            document.getElementById('rewardType').value = reward['Lo·∫°i'];
            document.getElementById('erpStock').value = reward['T·ªìn kho (ERP)'];
            
            if (isRedemption) {
                document.getElementById('redeemPoints').value = reward['ƒêi·ªÉm quy ƒë·ªïi'];
                document.getElementById('allocatedQty').value = reward['S·ªë l∆∞·ª£ng cho ph√©p ƒë·ªïi'];
            } else {
                document.getElementById('programQty').value = reward['S·ªë l∆∞·ª£ng cho ph√©p ƒë·ªïi'];
                document.getElementById('programNote').value = 'Qu√† t·∫∑ng ch∆∞∆°ng tr√¨nh';
            }
            
            // Hide item selection for edit mode
            document.getElementById('itemSelectSection').style.display = 'none';
            
            closeDetailModal();
            document.getElementById('rewardModal').classList.add('active');
        }

        // Pause reward
        function pauseReward(code) {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën t·∫°m d·ª´ng ph·∫ßn th∆∞·ªüng n√†y?')) {
                const reward = rewardsData.find(r => r['M√£ qu√†'] === code);
                if (reward) {
                    reward['Tr·∫°ng th√°i'] = 'Inactive';
                    loadRewards();
                    alert('Ph·∫ßn th∆∞·ªüng ƒë√£ ƒë∆∞·ª£c t·∫°m d·ª´ng!');
                }
            }
        }

        // Delete reward
        function deleteReward(code) {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a ph·∫ßn th∆∞·ªüng n√†y?')) {
                const index = rewardsData.findIndex(r => r['M√£ qu√†'] === code);
                if (index > -1) {
                    rewardsData.splice(index, 1);
                    filteredRewards = [...rewardsData];
                    loadRewards();
                    updateStats();
                    updateTabCounts();
                    alert('Ph·∫ßn th∆∞·ªüng ƒë√£ ƒë∆∞·ª£c x√≥a!');
                }
            }
        }

        // Export rewards
        function exportRewards() {
            alert('Xu·∫•t file CSV danh s√°ch ph·∫ßn th∆∞·ªüng');
        }

        // Import rewards
        function importRewards() {
            alert('Nh·∫≠p file CSV danh s√°ch ph·∫ßn th∆∞·ªüng');
        }

        // Sync with ERP
        function syncERP() {
            if (confirm('ƒê·ªìng b·ªô d·ªØ li·ªáu t·ªìn kho v·ªõi ERP?')) {
                alert('ƒêang ƒë·ªìng b·ªô d·ªØ li·ªáu...\nƒê√£ c·∫≠p nh·∫≠t ' + rewardsData.length + ' ph·∫ßn th∆∞·ªüng');
            }
        }
    </script>
</body>
</html>